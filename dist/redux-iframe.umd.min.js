!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ReduxIFrame={})}(this,(function(e){"use strict";var t,o=function(){return window.parent},n=function(e,t,o,n){return void 0===n&&(n=!1),function(r){return function(r){return function(i){if(i.__redux_iframe_event__)delete i.__redux_iframe_event__;else if(t.includes(i.type)){var a=e();if(a){var d=JSON.stringify(i);n&&console.log("Sending message",d),a.postMessage(d,o)}}r(i)}}}},r=function(e,t){var o;if(e)for(var n=0,r=t;n<r.length;n++){var i=r[n];i in e&&(o||(o={}),o[i]=e[i])}return o},i="redux-iframe-state";e.StorageType=void 0,(t=e.StorageType||(e.StorageType={}))[t.SESSION=0]="SESSION",t[t.LOCAL=1]="LOCAL";var a={rootKey:i,storageType:e.StorageType.SESSION},d=function(t){switch(t){case e.StorageType.LOCAL:return window.localStorage?window.localStorage:void console.warn("Local storage is not supported");case e.StorageType.SESSION:return window.sessionStorage?window.sessionStorage:void console.warn("Session storage is not supported")}},s=function(t,o,n){void 0===n&&(n=!1);var r=d(o.storageType||e.StorageType.SESSION);if(r)try{if(t)return n&&console.log("Saved state to storage:",t),r.setItem(o.rootKey||i,JSON.stringify(t)),!0}catch(e){console.warn("Cannot write to storage:",e)}return!1},u=function(e,t){for(var o in t)if(!e||e[o]!==t[o])return!0;return!1};e.combineState=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.reduce((function(e,t){if(e||t)return Object.assign({},e,t)}),void 0)},e.createModuleEventSender=function(e,t,o){return void 0===o&&(o=window.location.href),n(function(e){return function(){var t=document.getElementById(e);if(t){var o=t;if(o.contentWindow)return o.contentWindow}return null}}(t),e,o)},e.createParentEventSender=function(e,t){return void 0===t&&(t=window.location.href),n(o,e,t)},e.getParentState=function(e,t,o){if(void 0===t&&(t="ReduxStore"),void 0===o&&(o=!1),window.parent&&"object"==typeof window.parent[t]){var n=window.parent[t];if("function"==typeof n.getState){var i=n.getState(),a=r(i,e);return o&&console.log("Loaded state from parent window:",a),a}}},e.getStoredState=function(t,o,n){void 0===o&&(o=a),void 0===n&&(n=!1);var s=d(o.storageType||e.StorageType.SESSION);if(s)try{var u=s.getItem(o.rootKey||i);if(null===u)return;var f=r(JSON.parse(u),t);return n&&console.log("Loaded state from storage:",f),f}catch(e){console.warn("Cannot read from storage:",e)}},e.installEventListener=function(e,t,o){void 0===o&&(o={addMarker:!0,verbose:!1}),window.addEventListener("message",(function(n){o.verbose&&console.log("Received message",n.data);try{var r=JSON.parse(n.data);r.type&&t.includes(r.type)&&(o.addMarker&&(r.__redux_iframe_event__=!0),e.dispatch(r))}catch(e){}}))},e.installStorageWriter=function(e,t,o){var n;void 0===o&&(o=a),e.subscribe((function(){var i=r(e.getState(),t);i&&u(n,i)&&s(i,o)&&(n=i)}))},e.makeStoreGlobal=function(e,t){void 0===t&&(t="ReduxStore"),window[t]=e},Object.defineProperty(e,"__esModule",{value:!0})}));
